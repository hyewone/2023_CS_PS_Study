# ðŸ’»í”„ë¡œì„¸ìŠ¤ ë™ê¸°í™”

`í˜‘ë ¥ì  í”„ë¡œì„¸ìŠ¤`ëŠ” ì‹œìŠ¤í…œ ë‚´ì—ì„œ ì‹¤í–‰ì¤‘ì¸ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì˜ ì‹¤í—¹ì— ì˜í–¥ì„ ì£¼ê³  ë°›ëŠ” í”„ë¡œì„¸ìŠ¤ ì´ë‹¤.\
í˜‘ë ¥ì  í”„ë¡œì„¸ìŠ¤ëŠ” IPCë¥¼ í†µí•´ í†µì‹ í•˜ê³ , ìžì›ì„ ê³µìœ í•œë‹¤.

ê³µìœ  ìžì›ì„ ë™ì‹œì— ì ‘ê·¼í•˜ë©´, ë°ì´í„°ì˜ ì¼ê´€ì„±ì´ ë§ê°€ì§ˆ ìˆ˜ ìžˆë‹¤. 
> ![Alt text](image-3.png)


ì˜ˆì‹œë¥¼ ë“¤ì–´ë³´ë©´,
> ê³µìœ  ìžì›ì¸ ì „ì—­ë³€ìˆ˜ `ì˜ˆê¸ˆ 10ë§Œì›`ì´ ìžˆë‹¤ê³  ê°€ì •í•˜ìž.
> A í”„ë¡œì„¸ìŠ¤ê°€ `ì˜ˆê¸ˆ 10ë§Œì›`ì„ í™•ì¸í•œ ìƒí™©ì—ì„œ B í”„ë¡œì„¸ìŠ¤ê°€ `ì˜ˆê¸ˆ 15ë§Œì›ì„ ìž…ê¸ˆ`í•˜ì—¬ ì´ `25ë§Œì›ì˜ ì˜ˆê¸ˆ`ì´ ì €ìž¥ëœë‹¤.
> í•˜ì§€ë§Œ, A í”„ë¡œì„¸ìŠ¤ê°€ í™•ì¸í–ˆë˜ ì˜ˆê¸ˆì€ 10ë§Œì›ì´ê¸° ë•Œë¬¸ì— ë”°ë¡œ 10ë§Œì›ì„ ì¶”ê°€í•˜ë”ë¼ê³  15 + 10 = 25ë§Œì›ì´ ì•„ë‹ˆë¼, `10 + 10 = 20ë§Œì›` ì´ë¼ëŠ” ì´ ì˜ˆê¸ˆì´ ì €ìž¥ë˜ê²Œ ëœë‹¤.

ì´ë ‡ê²Œ ì •í™•í•˜ì§€ ì•Šì€ ìƒíƒœëŠ”,, ë‘ ê°œì˜ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‹œì— `ì˜ˆê¸ˆ ë³€ìˆ˜`ë¥¼ ì¡°ìž‘í•˜ë„ë¡ í—ˆìš©í–ˆê¸° ë•Œë¬¸ì´ë‹¤.

ì´ë ‡ê²Œ ë™ì‹œì— ì—¬ëŸ¬ ê°œì˜ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì¼í•œ ë°ì´í„°ì— ì ‘ê·¼í•˜ê³ , ì¡°ìž‘í•˜ì—¬ ê·¸ ì‹¤í–‰ ê²°ê³¼ê°€ ì ‘ê·¼ì´ ë°œìƒí•œ íŠ¹ì • ìˆœì„œì— ì˜ì¡´í•˜ëŠ” ìƒí™©ì„ `ê²½ìŸ ì¡°ê±´(race condition)`ì´ë¼ê³  í•œë‹¤.

ì´ëŸ° race conditionìœ¼ë¡œë¶€í„° ë³´í˜¸í•˜ê¸° ìœ„í•´, í•œ ìˆœê°„ì— í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ë§Œì´ ì˜ˆê¸ˆ ë³€ìˆ˜ë¥¼ ì¡°ìž‘í•  ìˆ˜ ìžˆë„ë¡ ë³´ìž¥í•´ì•¼í•œë‹¤. ê·¸ë¦¬ê³  í”„ë¡œì„¸ìŠ¤ë“¤ì´ ë™ê¸°í™”ë˜ë„ë¡ í•´ì•¼í•œë‹¤.


***ì •ë¦¬***
* ê³µìœ  ìžì›\
    ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ê°€ ê³µë™ìœ¼ë¡œ ì´ìš©í•˜ëŠ” ë³€ìˆ˜, ë©”ëª¨ë¦¬, íŒŒì¼ ë“±ì„ ë§í•œë‹¤.\
    ê³µë™ìœ¼ë¡œ ì´ìš©ë˜ê¸° ë•Œë¬¸ì— ëˆ„ê°€, ì–¸ì œ ë°ì´í„°ë¥¼ ì½ê±°ë‚˜ ì“°ëŠëƒì— ë”°ë¼ ê·¸ ê²°ê³¼ê°€ ë‹¬ë¼ì§„ë‹¤.
* ê²½ìŸ ì¡°ê±´(race condition)
    2ê°œ ì´ìƒì˜ í”„ë¡œì„¸ìŠ¤ê°€ ê³µìœ  ìžì›ì„ ë³‘í–‰ì ìœ¼ë¡œ ì½ê±°ë‚˜ ì“°ëŠ” ìƒí™©\
    ê²½ìŸ ì¡°ê±´ì´ ë°œìƒí•˜ë©´ ê³µìœ  ìžì› ì ‘ê·¼ ìˆœì„œì— ë”°ë¼ ì‹¤í–‰ ê²°ê³¼ê°€ ë‹¬ë¼ì§„ë‹¤.



### ðŸŽˆ í”„ë¡œì„¸ìŠ¤ ë™ê¸°í™”ê°€ í•„ìš”í•œ ì´ìœ 


***í”„ë¡œì„¸ìŠ¤ ë™ê¸°í™”***\
ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ê°€ ê³µìœ í•˜ëŠ” ìžì›ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ëŠ” ê²ƒ

ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ê°€ ì„œë¡œ í˜‘ë ¥í•´ ê³µìœ  ìžì›ì„ ì‚¬ìš©í•˜ëŠ” ìƒí™©ì—ì„œ ê²½ìŸì¡°ê±´ì´ ë°œìƒí•˜ë©´, ê³µìœ ìžì›ì˜ ì‹ ë¢°ì„±ì´ ë–¨ì–´ì§„ë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ í”„ë¡œì„¸ìŠ¤ë“¤ì´ ê³µìœ  ìžì›ì„ ì‚¬ìš©í•  ë•Œ íŠ¹ë³„í•œ ê·œì¹™ì„ ë§Œë“¤ì–´ì•¼í•œë‹¤.

### ðŸŽˆ ìž„ê³„êµ¬ì—­(Critical Section)

ê²½ìŸì¡°ê±´(race condition) ë•Œë¬¸ì—, í”„ë¡œì„¸ìŠ¤ë“¤ì´ ë™ì‹œ ì ‘ê·¼í•  ë•Œ ì ‘ê·¼ ìˆœì„œì— ë”°ë¼ ì‹¤í–‰ê²°ê³¼ê°€ ë‹¬ë¼ì§€ê³ , ë°ì´í„°ì˜ ì¼ê´€ì„±ë„ í•´ì¹˜ê²Œ ëœë‹¤.

ì´ëŸ° race conditionì´ ë°œìƒí•˜ëŠ” ê³³ì„ `ìž„ê³„êµ¬ì—­(Critical Section)`ì´ë¼ í•œë‹¤.
> ì‰½ê²Œ ë§í•´ 'ê³µìœ ìžì›ì„ ìˆ˜ì •í•˜ëŠ”' ì˜ì—­?!
> ![Alt text](image-2.png)
```cpp
#include <iostream>
#include <thread>
#include <mutex>

int shared = 0; // ê³µìœ ìžì›

int main(){
    bool flag = false;
    while(!flag){
        shared++;
        shared += 10;
        if(shared == 5) flag = true;
    }
}
```


### ðŸŽˆ ìž„ê³„êµ¬ì—­(Critical Section) ë¬¸ì œ í•´ê²° ì¡°ê±´
ìž„ê³„êµ¬ì—­ì—ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìžˆëŠ” ë°©ì•ˆì€ ë‹¤ìŒì˜ ì„¸ ê°€ì§€ ì¡°ê±´ì„ ì¶©ì¡±í•´ì•¼í•œë‹¤.
* ìƒí˜¸ë°°ì œ(mutual exclusion)\
í•˜ë‚˜ì˜  í”„ë¡œì„¸ìŠ¤/ì“°ë ˆë“œê°€ ìž„ê³„êµ¬ì—­(Critical Section)ì— ë“¤ì–´ê°€ ìžˆìœ¼ë©´ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ëŠ” ë“¤ì–´ê°ˆ ìˆ˜ ì—†ë‹¤.\
â†’ ë°°íƒ€ì /ë…ì  ì‚¬ìš©!\
â†’ ë¨¼ì € ìž„ê³„êµ¬ì—­(critical section)ì— ì§„ìž…í•œ ì• ê°€ ì‹¤í–‰ì´ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼\
â†’ context switchingì´ ì¼ì–´ë‚˜ë„ ìž„ê³„ êµ¬ì—­ì—ëŠ” í•œ ì“°ë ˆë“œ/í”„ë¡œì„¸ìŠ¤ë§Œ ì§„ìž… ã„±ã„´
> ![Alt text](image-5.png)
> T1ì´ ìž„ê³„ êµ¬ì—­ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê³  ìžˆëŠ” ë™ì•ˆ T2ê°€ ëŒ€ê¸° â†’ ìƒí˜¸ë°°ì œ ì„±ê³µ!
> ì¼ë°˜ì½”ë“œ(non-critical code) : ê³µìœ  ìžì›ì— ì ‘ê·¼í•˜ì§€ ì•ˆëŠ” ì½”ë“œ
> ìž„ê³„êµ¬ì—­ ì§„ìž… ì½”ë“œ(entry code) : ìƒí˜¸ ë°°ì œë¥¼ ìœ„í•œ ì²˜ë¦¬ ìˆ˜í–‰. í˜„ìž¬ í”„ë¡œì„¸ìŠ¤/ì“°ë ˆë“œë§Œì´ ìž„ê³„ ì˜ì—­ì„ ìˆ˜í–‰í•  ìˆ˜ ìžˆë„ë¡ ì²˜ë¦¬í•¨
>  ìž„ê³„ì˜ì—­ ì§„ì¶œ ì½”ë“œ(exit code) : ìƒí˜¸ ë°°ì œë¥¼ ìœ„í•œ ì²˜ë¦¬ ìˆ˜í–‰. ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤/ì“°ë ˆë“œê°€ ìž„ê³„ ì˜ì—­ì— ì§„ìž…í•  ìˆ˜ ìžˆë„ë¡ ì²˜ë¦¼
* í•œì •ëŒ€ê¸°(bounded waiting)\
ìƒí˜¸ë°°ì œ(mutual exclusion)ë•Œë¬¸ì— ê¸°ë‹¤ë¦¬ê²Œ ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ë¬´í•œ ëŒ€ê¸°í•˜ì§€ ì•Šì•„ì•¼ í•œë‹¤. ì¦‰, íŠ¹ì • í”„ë¡œì„¸ìŠ¤ê°€ ìž„ê³„ êµ¬ì—­ì— ì§„ìž…í•˜ì§€ ëª»í•˜ë©´ ì•ˆëœë‹¤.\
â†’ ìž„ê³„êµ¬ì—­ ì§„ìž… íšŸìˆ˜ì— í•œê³„ë¥¼ ê±¸ì–´ë†“ê³ , í”„ë¡œì„¸ìŠ¤ê°€ ê³„ì†í•´ì„œ ë…ì í•´ì„œ ì‚¬ìš©í•˜ì§€ ëª»í•˜ê²Œ í•œë‹¤.
* ì§„í–‰ì˜ ìœµí†µì„±(progress flexibility, progress)\
ìž„ê³„êµ¬ì—­ì— í”„ë¡œì„¸ìŠ¤ê°€ ì—†ë‹¤ë©´ ì–´ë– í•œ í”„ë¡œì„¸ìŠ¤ë¼ë„ ë“¤ì–´ê°€ì„œ ìžì›ì„ í™œìš©í•  ìˆ˜ ìžˆë‹¤. 

### ðŸŽˆ ìž„ê³„êµ¬ì—­ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ì•ˆ(ë™ê¸°í™” ë°©ë²•)
ìž„ê³„êµ¬ì—­ì—ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œëŠ” ì•„ëž˜ì˜ ì„¸ê°€ì§€ë¥¼ í†µí•´ í•´ê²°í•  ìˆ˜ ìžˆë‹¤.
* ì†Œí”„íŠ¸ì›¨ì–´ ê¸°ë°˜ í•´ê²°ë²•\
â†’ Peterson's Solution
* í•˜ë“œì›¨ì–´ ê¸°ë°˜ í•´ê²°ë²•
* ìƒìœ„ ìˆ˜ì¤€ ì†Œí”„íŠ¸ì›¨ì–´ ë„êµ¬

### ðŸŽˆ í”¼í„°ìŠ¨ì˜ ì•Œê³ ë¦¬ì¦˜(Peterson's Solution)
ìž„ê³„êµ¬ì—­ ë¬¸ì œë¥¼ `ì†Œí”„íŠ¸ì›¨ì–´ì ìœ¼ë¡œ í•´ê²°`ëŠ” ë°©ë²•ì´ë‹¤.

`turn`ê³¼ `flag`ë¼ëŠ” ë³€ìˆ˜ë¡œ ìž„ê³„êµ¬ì—­(critical section)ì— ë“¤ì–´ê°ˆ í”„ë¡œì„¸ìŠ¤/ì“°ë ˆë“œë¥¼ ê²°ì •í•œë‹¤.
â†’ ë‘ í”„ë¡œì„¸ìŠ¤ê°€ ë‘ ê°œì˜ ë°ì´í„° í•­ëª©ì„ ê³µìœ í•˜ë©° í•´ê²°í•œë‹¤.
> * `int turn` : ìž„ê³„êµ¬ì—­ìœ¼ë¡œ ì§„ìž…í•  í”„ë¡œì„¸ìŠ¤ì˜ ìˆœë²ˆ(turn = iì´ë©´, Piê°€ ìž„ê³„êµ¬ì—­ì„ ì‹¤í–‰í•œë‹¤.)
> * `bool flag[2]` : íŠ¹ì • í”„ë¡œì„¸ìŠ¤ê°€ ìž„ê³„êµ¬ì—­ìœ¼ë¡œ ë“¤ì–´ê°ˆ ì¤€ë¹„ê°€ ë˜ì—ˆë‹¤ëŠ” ê²ƒì„ íƒ€ë‚˜ë‚¸ë‹¤.(flag[i] = trueì´ë©´, í”„ë¡œì„¸ìŠ¤ Piê°€ ìž„ê³„êµ¬ì—­ìœ¼ë¡œ ë“¤ì–´ê°ˆ ì¤€ë¹„ê°€ ë˜ì—ˆë‹¤ëŠ” ê²ƒ)
>![Alt text](image-6.png)
> â†’ í”„ë¡œì„¸ìŠ¤ Piê°€ ìž„ê³„ êµ¬ì—­ìœ¼ë¡œ ì§„ìž…í•˜ê¸° ìœ„í•´ `flag[i] = true`ë¡œ í•´ë†“ê³ , turnì„ jë¡œ ì§€ì •í•œë‹¤. í”„ë¡œì„¸ìŠ¤ Pjê°€ ìž„ê³„êµ¬ì—­ìœ¼ë¡œ ì§„ìž…í•˜ê¸° ì›í•œë‹¤ë©´ ì§„ìž…ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì„ ë³´ìž¥í•¨.\
> â†’ ìž„ê³„êµ¬ì—­ìœ¼ë¡œ ì§„ìž…í•˜ê¸° ì „ flag[j]ê°€ trueì¸ì§€ í™•ì¸í•˜ê³ (Pjê°€ ìž„ê³„êµ¬ì—­ì— ì§„ìž…í•´ ìžˆëŠ”ì§€ í™•ì¸) ê·¸ë ‡ë‹¤ë©´ ë¬´í•œë£¨í”„, ì•„ë‹ˆë¼ë©´ ë¬´í•œë£¨í”„ë¥¼ ë¹ ì ¸ë‚˜ì™€ critical sectionìœ¼ë¡œ ì§„ìž…í•œë‹¤.
>![Alt text](image-7.png)
> í”„ë¡œì„¸ìŠ¤ P0ì™€ P1ì´ ìžˆë‹¤.
> ***P0***
> â†’ ë¨¼ì €, P0ëŠ” flagë¥¼ trueë¡œ, turnì€ 1ë¡œ ì„¤ì •í•œë‹¤.\
> â†’ flag[1] == true && turn == 1ì´ë©´ P0ëŠ” ë¬´í•œë£¨í”„ë¥¼ ëˆë‹¤(=> P1ì˜ ì‹¤í–‰ì´ ëë‚ ë•Œê¹Œì§€ P0ê°€ ë¬´í•œ ë£¨í”„ë¥¼ ëŒë©´ì„œ ê¸°ë‹¤ë¦°ë‹¤ëŠ” ì˜ë¯¸!)\
> â†’ P1ì˜ ìž„ê³„êµ¬ì—­(critical section) ì‹¤í–‰ì´ ëë‚˜ë©´, P0ëŠ” whileì˜ ë¬´í•œë£¨í”„ë¥¼ ë¹ ì ¸ ë‚˜ì™€, ìž„ê³„êµ¬ì—­ì„ ì‹¤í–‰í•œë‹¤.\
> â†’ ìž„ê³„êµ¬ì—­ ì‹¤í–‰ì´ ëë‚˜ë©´ flag[0] = false í•´ì¤ë‹ˆë‹¤
> ***P1***
> â†’ ë¨¼ì €, P1ëŠ” flagë¥¼ trueë¡œ, turnì€ 0ë¡œ ì„¤ì •í•œë‹¤.\
> â†’ flag[0] == true && turn == 0ì´ë©´ P0ëŠ” ë¬´í•œë£¨í”„ë¥¼ ëˆë‹¤(=> P0ì˜ ìž„ê³„êµ¬ì—­ ì‹¤í–‰ì´ ëë‚ ë•Œê¹Œì§€ P1ê°€ ë¬´í•œ ë£¨í”„ë¥¼ ëŒë©´ì„œ ê¸°ë‹¤ë¦°ë‹¤ëŠ” ì˜ë¯¸!)\
> â†’ P0ì˜ ìž„ê³„êµ¬ì—­(critical section) ì‹¤í–‰ì´ ëë‚˜ë©´, P1ëŠ” whileì˜ ë¬´í•œë£¨í”„ë¥¼ ë¹ ì ¸ ë‚˜ì™€, ìž„ê³„êµ¬ì—­ì„ ì‹¤í–‰í•œë‹¤.\
> â†’ ìž„ê³„êµ¬ì—­ ì‹¤í–‰ì´ ëë‚˜ë©´ flag[1] = false í•´ì¤ë‹ˆë‹¤

### ðŸŽˆ í”¼í„°ìŠ¨ ì•Œê³ ë¦¬ì¦˜ì´ 'ìž„ê³„êµ¬ì—­ ë¬¸ì œ í•´ê²° ì¡°ê±´'ì— ë¶€í•©í•˜ëŠ”ê°€?
1. ìƒí˜¸ë°°ì œ(mutual exclusion) ë¶€í•©ðŸ€\
P0ê³¼ P1ì´ ë™ì‹œì— ìž„ê³„ ì˜ì—­ì— ë“¤ì–´ê°„ë‹¤ëŠ” ê²ƒì€ ìš°ì„  flag[0] = flag[1] = trueì—¬ì•¼í•œë‹¤. turnì€ intë‹ˆê¹ 0ê³¼ 1 ì¤‘ í•œê°œì˜ ê°’ë§Œ ê°€ì§ˆ ìˆ˜ ìžˆë‹¤. ë”°ë¼ì„œ, P0ê³¼ P1ì€ ë™ì‹œì— ìž„ê³„ ì˜ì—­ì— ì§„ìž…í•´ ì‹¤í–‰í•  ìˆ˜ ì—†ë‹¤. 
2. ì§„í–‰ì˜ ìœµí†µì„±(progress) ë¶€í•©ðŸ€\
ìž„ê³„êµ¬ì—­ì„ ì´ìš©í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ì—†ì„ ë•Œ, ì–´ë–¤ í”„ë¡œì„¸ìŠ¤ë¼ë„ ì§€ì²´ì—†ì´ ìž„ê³„êµ¬ì—­ì— ì ‘ê·¼í•  ìˆ˜ ìžˆë‚˜?\
ê° í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•´ ì´ˆê¸° flagëŠ” falseë¥¼ ê°€ì§€ê³  ìžˆë‹¤ê°€ ìž„ê³„êµ¬ì—­ì„ ì‹¤í–‰í•˜ê³  ì‹¶ì„ë•Œ í”¼í„°ìŠ¨ ì†”ë£¨ì…˜ì— ì ‘ê·¼í•˜ì—¬ flagë¥¼ trueë¡œ ê°€ì§„ë‹¤.\
P0ì´ ìž„ê³„êµ¬ì—­(critical section)ì— ë“¤ì–´ê°ˆ ì¤€ë¹„ê°€ ë˜ì§€ ì•Šì•˜ìœ¼ë©´ flag[0] = falseë‹¤. ì¦‰, P1ì´ ìž„ê³„ ì—­ì—­ì— ë“¤ì–´ê°ˆ ìˆ˜ ìžˆëŠ” ìƒí™©ì¸ ê±°ë‹¤.\
P0ì´ whileë¬¸ì—ì„œ P1ì˜ ìž„ê³„êµ¬ì—­ ì‹¤í–‰ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê³  ìžˆì„ ë•Œ, turn ê°’ì€ 0ì´ê±°ë‚˜ 1ì´ë‹¤. ë§Œì•½ turnì´ 1ì´ë©´, P1ì´ ìž„ê³„ ì˜ì—­ì— ë“¤ì–´ê°ˆ ìˆ˜ ìžˆìœ¼ë©°, turnì´ 0ì´ë©´ P0ì´ ìž„ê³„ ì˜ì—­ì— ë“¤ì–´ê°€ê²Œ ëœë‹¤.
3. í•œì •ëŒ€ê¸°(bounded waiting) ë¶€í•©ðŸ€\
ì–´ë– í•œ í”„ë¡œì„¸ìŠ¤ë„ ë¬´í•œížˆ ëŒ€ê¸°í•˜ëŠ” ê¸°ì•„ìƒíƒœ(starvation)ì— ë¹ ì§€ë©´ ì•ˆëœë‹¤.\
í”„ë¡œì„¸ìŠ¤ê°€ 2ê°œì¸ í”¼í„°ìŠ¨ ì†”ë£¨ì…˜ì—ì„œëŠ” í•œìª½ì´ ëŒ€ê¸°ë¥¼ í•˜ê³  ìžˆë‹¤ë©´ ë‹¤ë¥¸ í•œìª½ì´ ìž„ê³„ì˜ì—­ì„ ìž‘ì—…í•œ í›„ flagê°€ falseê°€ ë˜ëŠ” ìˆœê°„ ëŒ€ê¸°í•˜ë˜ í”„ë¡œì„¸ìŠ¤ê°€ ë°”ë¡œ ë¬´í•œ ë£¨í”„ë¥¼ ë¹ ì ¸ë‚˜ì™€ì„œ ìž„ê³„ êµ¬ì—­ìœ¼ë¡œ ì§„ìž…í•´ ì‹¤í–‰í•˜ê¸° ë•Œë¬¸ì— ê¸°ì•„ìƒíƒœ(starvation)ì€ ë°œìƒí•˜ì§€ ì•ŠìŒ

`+) progressì™€ bounded waitingì´ ë¶€í•©í•œì§€ ì²´í¬`\
 ìš°ë¦¬ëŠ” í”„ë¡œì„¸ìŠ¤ P0ê°€ ìž„ê³„ êµ¬ì—­ì— ì§„ìž… ëª» í•˜ë„ë¡ ë§‰ëŠ” ë°©ë²•ì€ ê·¸ê²ƒì„ while ë¬¸ì—(flag[1] == true && turn == 1) ì¡°ê±´ìœ¼ë¡œ ë¬¶ì–´ë‘ì–´ ê³„ì† ê³µíšŒì „í•˜ë„ë¡ ë§Œë“œëŠ” ë°©ë²•ì´ë¼ëŠ” ì‚¬ì‹¤ì— ì£¼ëª©í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤. ì´ while loopê°€ ìœ ì¼í•œ ë°©ë²•ì´ê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤. P1ê°€ ìž„ê³„ êµ¬ì—­ì— ë“¤ì–´ê°ˆ ì¤€ë¹„ê°€ ë˜ì§€ ì•Šì•˜ì„ ê²½ìš°ì—ëŠ” (flag[1] == false)ì´ê³  P0ëŠ” ìž„ê³„ êµ¬ì—­ì— ì§„ìž…í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. P1ê°€ flag[1]ë¥¼ trueë¡œ ì§€ì •í•˜ê³  ì—­ì‹œ ìžì‹ ì˜ while ë¬¸ì„ ìˆ˜í–‰í•˜ê²Œ ë˜ë©´ ì´ë•Œ turn == 0 ì´ë“ ì§€ turn == 1ì¼ ê²ƒìž…ë‹ˆë‹¤. turn == 0 ë¼ë©´ P0ê°€ ìž„ê³„ êµ¬ì—­ì— ì§„ìž…í•˜ê²Œ ë˜ê³  turn == 1ë¼ë©´ P1ê°€ ìž„ê³„ êµ¬ì—­ì— ì§„ìž…í•˜ê²Œ ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì¶”í›„ P1ê°€ ìž„ê³„ êµ¬ì—­ì„ ë¹ ì ¸ë‚˜ì˜¬ ë•ŒëŠ” P1ê°€ flag[1]ë¥¼ falseë¡œ ìž¬ì§€ì •í•˜ì—¬ P0ë¡œ í•˜ì—¬ê¸ˆ ìž„ê³„ êµ¬ì—­ì— ì§„ìž…í•˜ê²Œ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤. P1ê°€ flag[1]ë¥¼ trueë¡œ ìž¬ì§€ì •í•˜ê³  ë‚˜ë©´ ë°˜ë“œì‹œ turn ê°’ë„ 0ë¡œ ì§€ì •í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. P0ëŠ” while ë¬¸ì„ ìˆ˜í–‰í•˜ëŠ” ë™ì•ˆ turn ê°’ì„ ë°”ê¾¸ì§€ ì•Šê¸° ë•Œë¬¸ì— P0ëŠ” P1ê°€ ì§€ë‚œë²ˆì— ì§„ìž…í–ˆë‹¤ë©´ ì´ë²ˆì—ëŠ” ìžê¸°ë„ í•œ ë²ˆì€`(ë”°ë¼ì„œ ëŒ€ê¸° ì‹œê°„ì´ í•œì—†ì´ ê¸¸ì–´ì§€ì§€ ì•ŠìŒ)` ë“¤ì–´ê°ˆ ìˆ˜ ìžˆê²Œ`(progess ë³´ìž¥)` ë©ë‹ˆë‹¤.


### ðŸŽˆ í”¼í„°ìŠ¨ ì•Œê³ ë¦¬ì¦˜ì˜ ë¬¸ì œ 
â— í”¼í„°ìŠ¨ ì†”ë£¨ì…˜ì€ `í”„ë¡œì„¸ìŠ¤ê°€ ìµœëŒ€ 2ê°œì¸ ê²½ìš°`ë§Œ ê³ ë ¤í•œ ê²ƒì´ë‹¤. ê·¸ëž˜ì„œ í”„ë¡œì„¸ìŠ¤ê°€ 3ê°œ ì´ìƒì¸ ê²½ìš°ì—ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

â— í˜„ëŒ€ ì»´í“¨í„° ì•„í‚¤í…ì³ì—ì„œëŠ” ë³´ìž¥ëœ ìž‘ë™ì„ í•˜ì§€ ì•Šì„ ìˆ˜ ìžˆë‹¤.

### ðŸŽˆ Memory Barriers, test_and_set & compare_and_swap
`í•˜ë“œì›¨ì–´ì ìœ¼ë¡œ` ìž„ê³„êµ¬ì—­(critical section) ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì´ë‹¤.

ì»´í“¨í„° ì•„í‚¤í…ì²˜ê°€ ì‘ìš© í”„ë¡œê·¸ëž¨ì—ê²Œ ë©”ëª¨ë¦¬ë¥¼ ì–´ë–»ê²Œ ì œê³µí•˜ëŠëƒì— ë”°ë¼ 'ë©”ëª¨ë¦¬ ëª¨ë¸'ì´ ë‹¬ë¼ì§„ë‹¤.

1. ê°•í•œ ìˆœì„œ(strongly ordered)\
í•œ í”„ë¡œì„¸ì„œì˜ ë©”ëª¨ë¦¬ ë³€ê²½ ê²°ê³¼ê°€ ë‹¤ë¥¸ ëª¨ë“  í”„ë¡œì„¸ì„œì— ì¦‰ì‹œ ë³´ì¸ë‹¤.
2. ì•½í•œ ìˆœì„œ(weakly ordered)\
í•œ í”„ë¡œì„¸ì„œì˜ ë©”ëª¨ë¦¬ ë³€ê²½ ê²°ê³¼ê°€ ë‹¤ë¥¸ í”„ë¡œì„¸ì„œì— ì¦‰ì‹œ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤.

ë©”ëª¨ë¦¬ ëª¨ë¸ì€ í”„ë¡œì„¸ì„œ ìœ í˜•ì— ë”°ë¼ ë‹¤ë¥´ë¯€ë¡œ, ì»¤ë„ ê°œë°œ ì‹œ ê°€ì •í•  ìˆ˜ ì—†ë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì»´í“¨í„° ì•„í‚¤í…ì²˜ëŠ” `ë©”ëª¨ë¦¬ì˜ ëª¨ë“  ë³€ê²½ì‚¬í•­ì„ ë‹¤ë¥¸ ëª¨ë“  í”„ë¡œì„¸ì„œë¡œ ì „íŒŒí•˜ëŠ” ëª…ë ¹ì–´ë¥¼ ì œê³µ`í•˜ì—¬ ë‹¤ë¥¸ í”„ë¡œì„¸ì„œì—ì„œ ì‹¤í–‰ì¤‘ì¸ ì“°ë ˆë“œì— ë©”ëª¨ë¦¬ ë³€ê²½ì‚¬í•­ì´ ë³´ì´ëŠ” ê²ƒì„ ë³´ìž¥í•œë‹¤.

ì´ëŸ¬í•œ ëª…ë ¹ì–´ë¥¼ ë©”ëª¨ë¦¬ ìž¥ë²½(memory barrier) ë˜ëŠ” ë©”ëª¨ë¦¬ íŽœìŠ¤(memory fence)ë¼ê³  í•œë‹¤.

***ë©”ëª¨ë¦¬ ìž¥ë²½(memory barrier)***
ë©”ëª¨ë¦¬ ìž¥ë²½ ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë  ë•Œ, ì‹œìŠ¤í…œì€ ë‹¤ìŒ ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ëª¨ë“  ì ìž¬ë‚˜ ì €ìž¥ì´ ì™„ë£Œë˜ë„ë¡ í•œë‹¤. ë§Œì•½ ëª…ë ¹ì–´ê°€ ìž¬ë°°ì¹˜ë˜ë”ë¼ë„, ì´í›„ ëª…ë ¹ ì‹¤í–‰ ì „ì— ì €ìž¥ì´ ì™„ë£Œë˜ê³  ê·¸ ê²°ê³¼ê°€ ëª¨ë‘ì—ê²Œ ë³´ì¸ë‹¤.
> ![Alt text](image-8.png)
> ì“°ë ˆë“œ1ì—ì„œëŠ” flag ê°’ì´ xë³´ë‹¤ ë¨¼ì € ì ìž¬ë˜ë„ë¡ ë³´ìž¥í•œë‹¤.
> ì“°ë ˆë“œ2ì—ì„œëŠ” xê°’ì´ flag ê°’ë³´ë‹¤ ë¨¼ì € ë°°ì •ë˜ë„ë¡ ë³´ìž¥í•œë‹¤.

ë©”ëª¨ë¦¬ ìž¥ë²½ì„ í†µí•´ petersonì˜ í•´ê²°ë°©ë²•ì˜ ìž¬ë°°ì¹˜ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìžˆë‹¤.

***test_and_set() & compare_and_swap()***

í•˜ë“œì›¨ì–´ ëª…ë ¹ì–´ëŠ” ë°ì´í„° ì ‘ê·¼ â†’ ì—°ì‚° â†’ ì—°ì‚° ê²°ê³¼ ì €ìž¥ ê³¼ì •ì„ í•œë²ˆì— ìˆ˜í–‰í•  ìˆ˜ ìžˆë„ë¡ í•˜ë“œì›¨ì–´ì ì¸ ì§€ì›ì„ í•´ì£¼ëŠ” ê²ƒì´ë‹¤.\
í•œë²ˆì— ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ atomically(ì›ìžì ìœ¼ë¡œ)í•˜ê²Œ ìˆ˜í–‰í•œë‹¤ê³  í‘œí˜„í•˜ëŠ”ë°, ì›ìžì ìœ¼ë¡œ ìˆ˜í–‰í•œë‹¤ëŠ” ê²ƒì€ ì¸í„°ëŸ½íŠ¸ ë˜ì§€ ì•Šê³  ìˆ˜í–‰ëœë‹¤ëŠ” ê²ƒì´ë‹¤.

***test_and_set(lock)***
```python
def test_and_set(lock):
	tmp = lock

	lock = True

	return tmp
```
* test_and_set(lock) ëª…ë ¹ì–´ëŠ” lockì˜ ê°’ì„ ì½ê³ (ë³µì‚¬ í›„ ë°˜í™˜), lockì„ Trueë¡œ ì„¤ì •í•˜ëŠ” ì¼ì„ í•œë²ˆì—(ì›ìžì ìœ¼ë¡œ) ìˆ˜í–‰í•œë‹¤.
```python
while test_and_set(lock) :
	#wait
	continue

#critical section

#lock í•´ì œ
lock = False
```
> - ë§Œì•½, lockì´ trueì˜€ë‹¤ë©´, test_and_setì€ lockì„ Trueë¡œ ì„¤ì •í•˜ê³ , Trueë¥¼ ë°˜í™œí•  ê²ƒì´ë¯€ë¡œ ë°˜ë³µë¬¸ì—ì„œ ëŒê²Œ ëœë‹¤.
> - ë§Œì•½ lcokì´ falseì˜€ë‹¤ë©´, test_and_setì€ lockì„ trueë¡œ ì„¤ì •ì§€ë§Œ, falseë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ ë°˜ëª©ë¬¸ì—ì„œ ë¹ ì ¸ ë‚˜ì™€ crictical sectionì„ ìˆ˜í–‰í•œë‹¤. ìˆ˜í–‰ì´ ëë‚˜ë©´ ë‹¤ì‹œ lockì„ falsë¡œ ì„¤ì •í•œë‹¤.

***compare_and_swap()***
```python
def compare_and_swap(value, expected, new_value):
	tmp = value

	if value == expected :
		value = new_value

	return tmp
```
* valueê°’ì„ ì½ê³ (ë³µì‚¬ í›„ ë°˜í™˜), valueê°€ expectedì™€ ê°™ë‹¤ë©´, valueì˜ ê°’ì„ new_valueë¡œ ì„¤ì •í•˜ëŠ” ì¼ì„ í•œë²ˆì— ìˆ˜í–‰í•œë‹¤.
```python
while compare_and_swap(lock, False, True) : 
	#wait
	continue

#ciritical section

#lock í•´ì œ
lock = False
```
* ë§Œì•½ lockì´ Trueì˜€ë‹¤ë©´, compare_and_swapì€ lockì„ Trueë¥¼ ë°˜í™˜í•˜ì—¬ ë°˜ë³µë¬¸ì—ì„œ ëŒê²Œëœë‹¤.
* ë§Œì•½ lockì´ Falseì˜€ë‹¤ë©´, compare_and_swapì€expected ê°’ì¸ Falseì™€ ê°™ê¸° ë•Œë¬¸ì— lockì„ Trueë¡œ ì„¤ì •í•˜ì§€ë§Œ, Falseë¥¼ ë°˜í™˜í•˜ê¸° ë•Œë¬¸ì— ë°˜ë³µë¬¸ì—ì„œ ë¹ ì ¸ë‚˜ì™€ critical sectionì„ ìˆ˜í–‰í•œë‹¤. ìˆ˜í–‰ì´ ëë‚˜ë©´ ë‹¤ì‹œ lockì„ Falseë¡œ ì„¤ì •í•œë‹¤.

### ðŸŽˆ Mutex Locks, Semaphores
`ìƒìœ„ ìˆ˜ì¤€ ì†Œí”„íŠ¸ì›¨ì–´ ë„êµ¬`ë¡œ ìž„ê³„êµ¬ì—­(criticcal section) ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì´ë‹¤.




***mutex***
ê³µìœ ìžì› ë° ìž„ê³„êµ¬ì—­ì— í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤/ì“°ë ˆë“œê°€ ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ë§‰ì•„ì¤€ë‹¤.

ë™ê¸°í™” ëŒ€ìƒì´ í•˜ë‚˜ë‹¤.

* ìž„ê³„êµ¬ì—­ì„ ê°€ì§„ ì“°ë ˆë“œì˜ `ì‹¤í–‰ì‹œê°„(Running Time)ì´ ì„œë¡œ ê²¹ì¹˜ì§€ ì•Šê³ ` ê°ê° ë‹¨ë…ìœ¼ë¡œ ì‹¤í–‰(=> ìƒí˜¸ë°°ì œ mutual exclusion)ë˜ë„ë¡ í•˜ëŠ” ê¸°ìˆ ì´ë‹¤.
* í•œ í”„ë¡œì„¸ìŠ¤ì— ì˜í•´ ì†Œìœ ë  ìˆ˜ ìžˆëŠ” `keyë¥¼ ê¸°ë°˜(keyëŠ” ë®¤í…ìŠ¤ ê°ì²´ë¼ ìƒê°!)`ìœ¼ë¡œ í•œ ìƒí˜¸ë°°ì œ ê¸°ë²•\
(keyì— í•´ë‹¹í•˜ëŠ” ì–´ë–¤ ê°ì²´ê°€ ìžˆìœ¼ë©°, ì´ ê°ì²´ë¥¼ ì†Œìœ í•œ ì“°ë ˆë“œ/í”„ë¡œì„¸ìŠ¤ë§Œì´ ê³µìœ ìžì›ì— ì ‘ê·¼í•  ìˆ˜ ìžˆë”°.)
* ë‹¤ì¤‘ í”„ë¡œì„¸ìŠ¤ë“¤ì˜ ê³µìœ  ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì ‘ê·¼ì„ ì¡°ìœ¨í•˜ê¸° ìœ„í•´ `ë™ê¸°í™”(synchronization) ë˜ëŠ” ë½(lcok)`ì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ë®¤í…ìŠ¤ ê°ì²´ë¥¼ ë‘ ì“°ë ˆë“œê°€ ë™ì‹œì— ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
> ![Alt text](image-9.png)

***Semaphore***
ê³µìœ ìžì› ë° ìž„ê³„êµ¬ì—­ì— ì—¬ëŸ¬ê°œì˜ í”„ë¡œì„¸ìŠ¤/ì“°ë ˆë“œê°€ ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ë§‰ì•„ì¤€ë‹¤.

ë™ê¸°í™” ëŒ€ìƒì´ í•˜ë‚˜ì´ìƒì´ë‹¤.

ìžì›ì„ ì‚¬ìš©í•˜ê³  ìžˆëŠ” í”„ë¡œì„¸ìŠ¤/ì“°ë ˆë“œ ìˆ˜ë¥¼ ê³µí†µìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” í•˜ë‚˜ì˜ ê°’ì„ ì´ìš©í•´ ìƒí˜¸ë°°ì œ(mutual exclusion)ì— ë‹¬ì„±í•œë‹¤.

ê³µìœ ìžì›ì— ì ‘ê·¼í•  ìˆ˜ ìžˆëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ìµœëŒ€ í—ˆìš©ì¹˜ë§Œí¼ ë™ì‹œì— ì‚¬ìš©ìžê°€ ì ‘ê·¼í•  ìˆ˜ ìžˆìœ¼ë©°, ê° í”„ë¡œì„¸ìŠ¤ëŠ” ì„¸ë§ˆí¬ì–´ ê°’ì„ í™•ì¸í•˜ê³  ë³€ê²½í•  ìˆ˜ ìžˆë‹¤.

ìžì›ì„ ì‚¬ìš©í•˜ì§€ ì•Šã„´ëŠ” ìƒíƒœê°€ ë  ë•Œ, ëŒ€ê¸°í•˜ë˜ í”„ë¡œì„¸ìŠ¤ê°€ ì¦‰ì‹œ ìžì›ì„ ì‚¬ìš©í•˜ê³ , ì´ë¯¸ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì— ì˜í•´ ì‚¬ìš©ì¤‘ì´ë¼ëŠ” ì‚¬ì‹¤ì„ ì•Œê²Œ ë˜ë©´, ìž¬ì‹œë„ ì „ì— ì¼ì •ì‹œê°„ ëŒ€ê¸°í•´ì•¼í•œë‹¤.

> ![Alt text](image-10.png)

* ì˜ˆ) ì„¸ë§ˆí¬ì–´ ê°’ì´ 3ì´ê³ , ê³µìœ ìžì›ì„ ì“°ë ¤ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ 5ê°œë‹¤. ë¨¼ì € í”„ë¡œì„¸ìŠ¤ 3ê°œê°€ ê³µìœ  ìžì›ì„ ì‚¬ìš©í•˜ê³ (ì„¸ë§ˆí¬ì–´ 0), ê·¸ ë‹¤ìŒ í”„ë¡œì„¸ìŠ¤ëŠ” ì„¸ë§ˆí¬ì–´ê°€ ì–‘ìˆ˜ê°€ ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤. 

ì„¸ë§ˆ í¬ì–´ ê°’ì€ ì •ìˆ˜ ê°’ì„ ê°€ì§€ë©°, pì—°ì‚°ê³¼ vì—°ì‚°ì„ í†µí•´ ì œì–´ë©ë‹ˆë‹¤.

- ì„¸ë§ˆí¬ì–´ ê°’ì´ 0ì´ìƒì´ë©´ 1ì„ ê°ì†Œ, 0ë¯¸ë§Œì´ë©´ í˜¸ì¶œí•œ ìŠ¤ë ˆë“œ ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ëŒ€ê¸° ìƒíƒœë¡œ ì „í™˜
- í”„ë¡œì„¸ìŠ¤ ì§„ìž… ì—¬ë¶€ë¥¼ ìžì›ì˜ ê°œìˆ˜ë¡œ ê²°ì •
- V
    - critical section(ìž„ê³„êµ¬ì—­)ì—ì„œ ë‚˜ì˜¬ ë•Œ ìˆ˜í–‰
    - ì„¸ë§ˆí¬ì–´ ê°’ì„ ì¦ê°€ì‹œí‚¤ëŠ” ì—°ì‚°
    - ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ìžˆì„ ê²½ìš°, ê·¸ ì¤‘ í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ë¥¼ ê¹¨ì›Œì„œ 1ì¦ê°€í‚¨ë‹¤.
    - ìžì› ë°˜ë‚© ì•Œë¦¼, ëŒ€ê¸° ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ê¹¨ìš°ëŠ” ì‹ í˜¸
> ![Alt text](image-11.png)

